{"ast":null,"code":"var _jsxFileName = \"/Users/ailuoku6/web_project/flxEditor/packages/flx_editor/src/container/Editor/editorHelper.tsx\";\nimport React from \"react\";\nimport Toolbar from \"./components/Toolbar\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n// 接管编辑器的渲染及事件行为，分发给下属插件\nexport class EditorHelper {\n  constructor(editor, plugins) {\n    this.plugins = void 0;\n    this.elementPluginMap = void 0;\n    this.leafPlugins = void 0;\n    this.plugins = plugins;\n    this.elementPluginMap = new Map(plugins.filter(p => p.isElement).map(p => [p.name, p]));\n    this.leafPlugins = plugins.filter(p => p.isLeaf);\n    this.renderElement = this.renderElement.bind(this);\n    this.renderLeaf = this.renderLeaf.bind(this);\n    this.isVoid = this.isVoid.bind(this);\n    this.initEditorHelper(editor);\n  }\n  initEditorHelper(editor) {\n    editor.isVoid = this.isVoid;\n  }\n  renderElement(props) {\n    var _elePlugin$renderElem;\n    const {\n      element,\n      attributes,\n      children\n    } = props;\n    const type = element.type;\n    const elePlugin = this.elementPluginMap.get(type);\n    return (elePlugin === null || elePlugin === void 0 ? void 0 : (_elePlugin$renderElem = elePlugin.renderElement) === null || _elePlugin$renderElem === void 0 ? void 0 : _elePlugin$renderElem.call(elePlugin, props)) || /*#__PURE__*/_jsxDEV(\"p\", {\n      ...attributes,\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 58,\n      columnNumber: 44\n    }, this);\n  }\n\n  // 叶子节点效果可叠加\n  renderLeaf(props) {\n    const {\n      attributes,\n      children,\n      leaf\n    } = props;\n    let leafNode = /*#__PURE__*/_jsxDEV(\"span\", {\n      ...attributes,\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 20\n    }, this);\n    this.leafPlugins.forEach(leafP => {\n      const name = leafP.name;\n      if (leaf[name]) {\n        var _leafP$renderLeaf;\n        leafNode = (leafP === null || leafP === void 0 ? void 0 : (_leafP$renderLeaf = leafP.renderLeaf) === null || _leafP$renderLeaf === void 0 ? void 0 : _leafP$renderLeaf.call(leafP, {\n          ...props,\n          attributes: {},\n          children: leafNode\n        })) || leafNode;\n      }\n    });\n    return leafNode;\n  }\n  isVoid(ele) {\n    const type = ele.type;\n    const elePlugin = this.elementPluginMap.get(type);\n    return (elePlugin === null || elePlugin === void 0 ? void 0 : elePlugin.isVoid) || false;\n  }\n  renderToolBar() {\n    const toolBarWidgets = this.plugins.filter(p => {\n      var _p$widget;\n      return (_p$widget = p.widget) === null || _p$widget === void 0 ? void 0 : _p$widget.toolBarWidget;\n    }).map(p => {\n      var _p$widget2;\n      return (_p$widget2 = p.widget) === null || _p$widget2 === void 0 ? void 0 : _p$widget2.toolBarWidget;\n    });\n    return /*#__PURE__*/_jsxDEV(Toolbar, {\n      children: toolBarWidgets\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 12\n    }, this);\n  }\n}\nexport const withEditorHelper = () => {};","map":{"version":3,"names":["React","Toolbar","jsxDEV","_jsxDEV","EditorHelper","constructor","editor","plugins","elementPluginMap","leafPlugins","Map","filter","p","isElement","map","name","isLeaf","renderElement","bind","renderLeaf","isVoid","initEditorHelper","props","_elePlugin$renderElem","element","attributes","children","type","elePlugin","get","call","fileName","_jsxFileName","lineNumber","columnNumber","leaf","leafNode","forEach","leafP","_leafP$renderLeaf","ele","renderToolBar","toolBarWidgets","_p$widget","widget","toolBarWidget","_p$widget2","withEditorHelper"],"sources":["/Users/ailuoku6/web_project/flxEditor/packages/flx_editor/src/container/Editor/editorHelper.tsx"],"sourcesContent":["import React from \"react\";\n\nimport { BaseElement } from \"slate\";\n\nimport { RenderElementProps, RenderLeafProps, ReactEditor } from \"slate-react\";\n\nimport Toolbar from \"./components/Toolbar\";\n\nexport interface IFlxEditorPlugin {\n  name: string;\n  isElement: boolean;\n  isLeaf: boolean;\n  isVoid?: boolean;\n\n  renderElement?: (props: RenderElementProps) => JSX.Element | undefined;\n\n  renderLeaf?: (props: RenderLeafProps) => JSX.Element | undefined;\n\n  widget?: {\n    toolBarWidget?: JSX.Element;\n    renderWidgetOnPupup?: boolean;\n    blockToolbarWidget?: boolean;\n  };\n\n  eventHandles?: { [key: string]: (args: any[]) => boolean };\n}\n\n// 接管编辑器的渲染及事件行为，分发给下属插件\nexport class EditorHelper {\n  private plugins: IFlxEditorPlugin[];\n  private elementPluginMap: Map<string, IFlxEditorPlugin>;\n  private leafPlugins: IFlxEditorPlugin[];\n  constructor(editor: ReactEditor, plugins: IFlxEditorPlugin[]) {\n    this.plugins = plugins;\n\n    this.elementPluginMap = new Map(\n      plugins.filter((p) => p.isElement).map((p) => [p.name, p])\n    );\n\n    this.leafPlugins = plugins.filter((p) => p.isLeaf);\n\n    this.renderElement = this.renderElement.bind(this);\n    this.renderLeaf = this.renderLeaf.bind(this);\n    this.isVoid = this.isVoid.bind(this);\n\n    this.initEditorHelper(editor);\n  }\n\n  private initEditorHelper(editor: ReactEditor) {\n    editor.isVoid = this.isVoid;\n  }\n\n  renderElement(props: RenderElementProps) {\n    const { element, attributes, children } = props;\n    const type = (element as any).type as string;\n    const elePlugin = this.elementPluginMap.get(type);\n    return (\n      elePlugin?.renderElement?.(props) || <p {...attributes}>{children}</p>\n    );\n  }\n\n  // 叶子节点效果可叠加\n  renderLeaf(props: RenderLeafProps) {\n    const { attributes, children, leaf } = props;\n\n    let leafNode = <span {...attributes}>{children}</span>;\n\n    this.leafPlugins.forEach((leafP) => {\n      const name = leafP.name;\n      if ((leaf as any)[name]) {\n        leafNode =\n          leafP?.renderLeaf?.({\n            ...props,\n            attributes: {} as any,\n            children: leafNode,\n          }) || leafNode;\n      }\n    });\n\n    return leafNode;\n  }\n\n  private isVoid(ele: BaseElement) {\n    const type = (ele as any).type as string;\n    const elePlugin = this.elementPluginMap.get(type);\n    return elePlugin?.isVoid || false;\n  }\n\n  renderToolBar() {\n    const toolBarWidgets = this.plugins\n      .filter((p) => p.widget?.toolBarWidget)\n      .map((p) => p.widget?.toolBarWidget);\n\n    return <Toolbar>{toolBarWidgets}</Toolbar>;\n  }\n}\n\nexport const withEditorHelper = () => {};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}